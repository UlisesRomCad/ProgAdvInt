<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris</title>
    <style>
        canvas{
            background-color: black;
            padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        body{
            background-color: rgb(18, 18, 18);
        }

    </style>
</head>
<body>
    <canvas width="950" height="830" id="myCanvas"></canvas>
    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext('2d');

        let musica = new Audio();
        let pause = false;
        musica.src= "tetrisTheme.mp3";
        var score = 0;

        /*ctx.fillStyle = "#262626";*/


        ctx.lineWidth = 10;
        ctx.strokeStyle = "#62789c"
        ctx.strokeRect(0, 0, 950, 830);
        ctx.fillStyle = "#62789c"
        ctx.fillRect(650, 0, 300, 830);
        ctx.fillStyle = "black";
        ctx.fillRect(670, 300, 260, 160);
        ctx.strokeStyle = "#354a6e";
        ctx.strokeRect(670, 300, 260, 160);

        ctx.fillStyle = "black";
        ctx.fillRect(670, 630, 260, 70);
        ctx.strokeStyle = "#354a6e";
        ctx.strokeRect(670, 630, 260, 70);

        ctx.font = "40px Arial";
        ctx.fillStyle = "white";
        ctx.strokeStyle = "#30ced1";
        ctx.strokeText("Siguiente;", 712, 272);
        ctx.fillText("Siguiente:", 710, 270);
        ctx.strokeText("Puntuación:", 702, 600);
        ctx.fillText("Puntuación:", 700, 598);
        ctx.font= "30px Arial";
        ctx.fillStyle = "white";
        ctx.fillText(""+score+"", 700, 670);

        var img = new Image();
        img.src="tetrisLogo.png";
        img.onload = function(){
            ctx.drawImage(img, 660, 10, 280, 200);
        }

        var map = [];
        for (var i = 0; i < 20; i++) {
            map[i] = [];
            for (var j = 0; j < 10; j++) {
                map[i][j] = 0;
            }
        }

        var tetris = [
        // Pieza I
        [
            [0, 0, 0, 0],
            [1, 1, 1, 1],
            [0, 0, 0, 0],
            [0, 0, 0, 0]
        ],
        // Pieza O
        [
            [1, 1],
            [1, 1]
        ],
        // Pieza T
        [
            [0, 1, 0],
            [1, 1, 1],
            [0, 0, 0]
        ],
        // Pieza L
        [
            [0, 0, 1],
            [1, 1, 1],
            [0, 0, 0]
        ],
        // Pieza J
        [
            [1, 0, 0],
            [1, 1, 1],
            [0, 0, 0]
        ],
        // Pieza S
        [
            [0, 1, 1],
            [1, 1, 0],
            [0, 0, 0]
        ],
        // Pieza Z
        [
            [1, 1, 0],
            [0, 1, 1],
            [0, 0, 0]
        ]
    ];
        

        function syncMap(mapF, x, y){
            for(i = 0; i<mapF.length; i = i++){
                for(j = 0; j<mapF[i].length; j++){
                    
                }
            }
        }

        function checkFiles(){

        }

        function checkLoseCondition(y){

        }

        function changeDifficulty(score){

        }

        function drawCells(x, y) {
            var dif = 0;
            ctx.lineWidth = 2;
            ctx.strokeStyle = "#454444";
            for (i = 0; i < 20; i++) { // Cambia 120 a 20 para las filas
                for (j = 0; j < 10; j++) { // Cambia 10 a 20 para las columnas
                    if (map[i][j] === 1) {
                        ctx.fillStyle = "blue"; // Color de las celdas ocupadas
                    } else {
                        ctx.fillStyle = "#262626"; // Color de las celdas vacías
                    }
                    ctx.fillRect(x, y, 64.25, 64.25);
                    ctx.strokeRect(x, y, 64.25, 64.25);
                    x = x + 64.25;
                    dif = dif + 1;
                    if (dif == 10) {
                        x = 6;
                        dif = 0;
                        y = y + 64.25;
                    }
                }
            }
        }

        const squareSize = 64.25;
        let squareX = 6;
        let squareY = 6;

        function drawPiece(x, y, piece) {
            ctx.fillStyle = "blue"; // Color de las celdas ocupadas por la pieza
            for (let i = 0; i < piece.length; i++) {
                for (let j = 0; j < piece[i].length; j++) {
                    if (piece[i][j] === 1) {
                        ctx.fillRect(x + j * squareSize, y + i * squareSize, squareSize, squareSize);
                    }
                }
            }
        }

        function drawSquare() {
            ctx.clearRect(6, 6, 645, 773);
            ctx.fillStyle = "#262626";
            ctx.fillRect(5, 5, 645, 773);
        
            drawCells(6, 6);
        
            // Dibuja la pieza actual llamando a drawPiece
            drawPiece(squareX, squareY, piezaT);
        }

        var genTetris = Math.floor((Math.random() * 7))
        var piezaT = tetris[genTetris];
        document.addEventListener("keydown", (e) => {
            if (!pause) {
                musica.play();
            switch (e.keyCode) {
                case 65:
                squareX -= 64.25;
                break;
                case 68:
                squareX += 64.25;
                break;
                case 83:
                squareY += 64.25;
                break;
               }
            }

            switch(e.keyCode){  
                case 32:
                    pause = !pause;
                    musica.pause();
                break;  
            }

        squareX = Math.max(6, Math.min(650 - squareSize, squareX));
        squareY = Math.max(6, Math.min(778 - squareSize, squareY));

        //drawSquare();
        });

        function init()
        {
            window.requestAnimationFrame(init);
            update();
        }

        function update(){
            squareY+=2;
            if (squareY > 713.75){
                squareY = 713.75
            }
            drawSquare();
        }

        ctx.fillStyle = "#62789c";
        ctx.fillRect(5, 778, 645, 47);
        drawCells(6,6);

        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
        }());

        init();
    </script>
</body>
</html>